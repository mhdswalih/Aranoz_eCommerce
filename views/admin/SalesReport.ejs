<%- include('../layout/adminheder') %>

  <nav class="navbar p-0 fixed-top d-flex flex-row">
    <div class="navbar-brand-wrapper d-flex d-lg-none align-items-center justify-content-center">
      <a class="navbar-brand brand-logo-mini" href="/admin/home"><img src="/Admin assets/assets/images/logo-mini.svg" alt="logo" /></a>
    </div>
    <div class="navbar-menu-wrapper flex-grow d-flex align-items-stretch">
      <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
        <span class="mdi mdi-menu"></span>
      </button>
    
     
      <ul class="navbar-nav navbar-nav-right">
        <li class="nav-item dropdown d-none d-lg-block">
          <a class="nav-link btn btn-success create-new-button" id="createbuttonDropdown" href="/admin/download-Pdf">+ Pdf Download</a>
        </li>
        <li>
          <a class="nav-link btn btn-success create-new-button" id="createbuttonDropdown" href="/admin/download-excel">+ Excele Download </a>
        </li>
      </ul>
    </div>
  </nav>

  <div class="main-panel">
    <div class="content-wrapper">
      <div class="col-lg-12 grid-margin stretch-card">
        <div class="card">
          <div class="card-body">
            <h4 class="card-title">Sales Report</h4>
            <p>Total Sales: <%= totalSale %></p>

           <!-- Date Filter -->
<div class="date-filter">
  <form action="/admin/sales-report" method="get" class="form-inline">
    <!-- Year Dropdown -->
    <div class="form-group">
      <label for="year">Year:</label>
      <select id="year" name="year" class="form-control ml-2">
        <% for (let i = new Date().getFullYear(); i >= 2000; i--) { %>
          <option value="<%= i %>"><%= i %></option>
        <% } %>
      </select>
    </div>

    <!-- Month Dropdown -->
    <div class="form-group ml-2">
      <label for="month">Month:</label>
      <select id="month" name="month" class="form-control ml-2">
        <% const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']; %>
        <% months.forEach((month, index) => { %>
          <option value="<%= index + 1 %>"><%= month %></option>
        <% }); %>
      </select>
    </div>

    <!-- Day Dropdown -->
    <div class="form-group ml-2">
      <label for="day">Day:</label>
      <select id="day" name="day" class="form-control ml-2">
        <% for (let i = 1; i <= 31; i++) { %>
          <option value="<%= i %>"><%= i %></option>
        <% } %>
      </select>
    </div>

    <button type="submit" class="btn btn-success ml-2">Filter</button>
  </form>
</div>


            <!-- Sales Table -->
            <div class="table-responsive">
              <table class="table table-dark table-striped">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Date</th>
                    <th>Product Name</th>
                    <th>Quantity</th>
                    <th>Billing Name</th>
                    <th>Total Price</th>
                    <th>Discount Price</th>
                    <th>Payment Method</th>
                  </tr>
                </thead>
                <tbody>
                  <% if (SalesReport.length > 0) { %>
                    <% SalesReport.forEach((sale, index) => { %>
                      <tr>
                        <td><%= index + 1 %></td>
                        <td><%= new Date(sale.orderDate).toLocaleDateString() %></td>
                        <td><%= sale.product.productname %></td>
                        <td><%= sale.products.productquantity %></td>
                        <td><%= sale.user.name %></td>
                        <td>₹<%= sale.totalAmount.toFixed(2) %></td>
                        <td>₹<%= sale.discountAmount ? sale.discountAmount.toFixed(2) : '0.00' %></td>
                        <td><%= sale.selectedPaymentMethod %></td>
                      </tr>
                    <% }); %>
                  <% } else { %>
                    <tr>
                      <td colspan="8" class="text-center">No sales records found</td>
                    </tr>
                  <% } %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<%- include('../layout/adminfooter') %>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

<script>
  // Spinner on form submission
  document.querySelector('form').addEventListener('submit', function() {
    document.querySelector('.loading-spinner').style.display = 'block';
  });

  // Date validation to ensure start date is not after end date
  document.querySelector('form').addEventListener('submit', function(e) {
  const year = document.querySelector('#year').value;
  const month = document.querySelector('#month').value;
  const day = document.querySelector('#day').value;

  if (!year || !month || !day) {
    e.preventDefault();
    Swal.fire({
      icon: 'error',
      title: 'Invalid Date Selection',
      text: 'Please select a valid year, month, and day.'
    });
  }
});


  // SweetAlert for no sales records
  if (SalesReport.length === 0) { 
    Swal.fire({
      icon: 'info',
      title: 'No Sales Records',
      text: 'No sales records found for the selected date range.',
      confirmButtonText: 'Okay'
    });
  }
</script>
